<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleet Reserve - Car Booking System</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-card: #1a1a24; --bg-hover: #22222e; --accent-blue: #3b82f6; --accent-purple: #8b5cf6; --accent-green: #10b981; --accent-red: #ef4444; --text-primary: #f8fafc; --text-secondary: #94a3b8; --text-muted: #64748b; --border-color: #2a2a38; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at 20% 20%, rgba(59,130,246,0.08) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, rgba(139,92,246,0.08) 0%, transparent 50%); pointer-events: none; z-index: -1; }
        .config-notice { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem; }
        .config-card { background: var(--bg-card); border: 1px solid var(--accent-red); border-radius: 16px; padding: 2.5rem; max-width: 600px; width: 100%; text-align: center; }
        .config-card h1 { color: var(--accent-red); margin-bottom: 1rem; }
        .config-card code { display: block; background: var(--bg-primary); padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: left; font-family: 'Space Mono', monospace; font-size: 0.85rem; }
        .header { background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .logo { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { width: 42px; height: 42px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
        .logo-text { font-family: 'Space Mono', monospace; font-size: 1.25rem; font-weight: 700; }
        .logo-text span { color: var(--accent-blue); }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .sync-btn { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-family: inherit; font-size: 0.875rem; transition: all 0.2s; }
        .sync-btn:hover { border-color: var(--accent-blue); color: var(--text-primary); }
        .sync-btn.syncing .sync-icon { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .admin-toggle { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .admin-toggle:hover { border-color: var(--accent-purple); }
        .admin-toggle.active { background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(99,102,241,0.2)); border-color: var(--accent-purple); }
        .toggle-switch { width: 36px; height: 20px; background: var(--bg-primary); border-radius: 10px; position: relative; transition: all 0.3s; }
        .admin-toggle.active .toggle-switch { background: var(--accent-purple); }
        .toggle-switch::after { content: ''; position: absolute; width: 16px; height: 16px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: all 0.3s; }
        .admin-toggle.active .toggle-switch::after { left: 18px; }
        .main-container { display: flex; min-height: calc(100vh - 70px); }
        .sidebar { width: 280px; background: var(--bg-secondary); border-right: 1px solid var(--border-color); padding: 1.5rem; overflow-y: auto; }
        .sidebar-title { font-family: 'Space Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .car-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .car-item { padding: 0.75rem 1rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; }
        .car-item:hover { border-color: var(--accent-blue); transform: translateX(4px); }
        .car-item.selected { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(99,102,241,0.15)); border-color: var(--accent-blue); }
        .car-info { display: flex; align-items: center; gap: 0.75rem; }
        .car-icon { font-size: 1.25rem; }
        .car-name { font-weight: 500; }
        .car-plate { font-family: 'Space Mono', monospace; font-size: 0.75rem; color: var(--text-muted); }
        .delete-car { background: none; border: none; color: var(--accent-red); cursor: pointer; opacity: 0; transition: opacity 0.2s; padding: 0.25rem; font-size: 1rem; }
        .car-item:hover .delete-car { opacity: 1; }
        .add-car-form { margin-top: 1rem; padding: 1rem; background: var(--bg-card); border: 1px dashed var(--border-color); border-radius: 8px; }
        .form-group { margin-bottom: 0.75rem; }
        .form-group label { display: block; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem; }
        .form-group input { width: 100%; padding: 0.5rem 0.75rem; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-family: inherit; }
        .form-group input:focus { outline: none; border-color: var(--accent-blue); }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 6px; font-family: inherit; font-weight: 500; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 0.5rem; }
        .btn-primary { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
        .btn-secondary { background: var(--bg-hover); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-sm { padding: 0.375rem 0.75rem; font-size: 0.875rem; }
        .calendar-container { flex: 1; padding: 2rem; overflow-y: auto; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .calendar-nav { display: flex; align-items: center; gap: 1rem; }
        .nav-btn { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); cursor: pointer; transition: all 0.2s; }
        .nav-btn:hover { background: var(--bg-hover); border-color: var(--accent-blue); }
        .current-month { font-family: 'Space Mono', monospace; font-size: 1.5rem; font-weight: 700; min-width: 220px; text-align: center; }
        .today-btn { padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); cursor: pointer; font-family: inherit; }
        .today-btn:hover { background: var(--bg-hover); }
        .legend { display: flex; gap: 1.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: var(--text-secondary); }
        .legend-dot { width: 12px; height: 12px; border-radius: 3px; }
        .legend-dot.morning { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .legend-dot.evening { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .legend-dot.booked { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .calendar-grid { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); }
        .weekday { padding: 1rem; text-align: center; font-family: 'Space Mono', monospace; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); }
        .calendar-day { min-height: 100px; padding: 0.5rem; border-right: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); background: var(--bg-card); transition: background 0.2s; }
        .calendar-day:nth-child(7n) { border-right: none; }
        .calendar-day:hover { background: var(--bg-hover); }
        .calendar-day.other-month { background: var(--bg-secondary); opacity: 0.5; }
        .calendar-day.today { background: rgba(59,130,246,0.1); }
        .day-number { font-family: 'Space Mono', monospace; font-weight: 600; margin-bottom: 0.5rem; }
        .calendar-day.today .day-number span { background: var(--accent-blue); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; }
        .booking-slots { display: flex; flex-direction: column; gap: 0.25rem; }
        .booking-slot { padding: 0.375rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: space-between; }
        .booking-slot.morning { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: #1a1a24; }
        .booking-slot.evening { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; }
        .booking-slot.available:hover { transform: scale(1.02); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
        .booking-slot.booked { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; cursor: default; }
        .booking-slot.booked.admin-view { cursor: pointer; }
        .slot-label { display: flex; align-items: center; gap: 0.25rem; }
        .booked-by { font-size: 0.65rem; opacity: 0.9; max-width: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .remove-booking { background: none; border: none; color: white; cursor: pointer; opacity: 0; transition: opacity 0.2s; font-size: 0.75rem; }
        .booking-slot.booked.admin-view:hover .remove-booking { opacity: 1; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 2rem; width: 100%; max-width: 400px; margin: 1rem; transform: translateY(20px); transition: transform 0.3s; }
        .modal-overlay.active .modal { transform: translateY(0); }
        .modal-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .modal-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; }
        .modal-actions .btn { flex: 1; }
        .toast { position: fixed; bottom: 2rem; right: 2rem; padding: 1rem 1.5rem; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; display: flex; align-items: center; gap: 0.75rem; transform: translateY(100px); opacity: 0; transition: all 0.3s; z-index: 1001; }
        .toast.active { transform: translateY(0); opacity: 1; }
        .toast.success { border-color: var(--accent-green); }
        .toast.error { border-color: var(--accent-red); }
        .no-car-selected { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; min-height: 400px; text-align: center; color: var(--text-muted); }
        .no-car-selected .icon { font-size: 4rem; margin-bottom: 1rem; opacity: 0.5; }
        .no-car-selected h2 { font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-primary); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
        .loading-overlay .spinner { font-size: 4rem; animation: spin 1s linear infinite; margin-bottom: 1rem; }
        @media (max-width: 768px) { .main-container { flex-direction: column; } .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border-color); } .calendar-container { padding: 1rem; } .calendar-day { min-height: 80px; } .booking-slot { font-size: 0.6rem; padding: 0.25rem; } .header { padding: 1rem; } .header-actions { gap: 0.5rem; } .sync-btn span:not(.sync-icon) { display: none; } }
    </style>
</head>
<body>
    <script>
        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘  CONFIGURATION - EDIT THESE VALUES BEFORE UPLOADING TO GITHUB    â•‘
        // â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        // â•‘  1. Go to https://jsonbin.io and create a free account           â•‘
        // â•‘  2. Copy your X-Master-Key from the API Keys page                â•‘
        // â•‘  3. Replace 'YOUR_API_KEY_HERE' below with your key              â•‘
        // â•‘  4. Upload to GitHub, open the page                              â•‘
        // â•‘  5. Copy the BIN_ID from the popup and paste it below            â•‘
        // â•‘  6. Re-upload to GitHub - now everyone shares the same data!     â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const CONFIG = {
            API_KEY: '$2a$10$AUV97K0KjslbXeTkVR9PIOA/8PpTbbOzNYsSt0SL0MQ0oukRVSZhe',  // Your X-Master-Key from jsonbin.io
            BIN_ID: '698287bcae596e708fofofd5'                      // Fill this after first run
        };
        const ADMIN_CODE = '1234';
    </script>

    <div id="config-notice" class="config-notice" style="display:none;">
        <div class="config-card">
            <h1>âš ï¸ Configuration Required</h1>
            <p>Edit the index.html file and set your JSONBin API key.</p>
            <code>API_KEY: 'YOUR_API_KEY_HERE'  // Replace this</code>
            <p style="margin-top:1rem;color:var(--text-secondary);">Get your free API key at <a href="https://jsonbin.io" target="_blank" style="color:var(--accent-blue);">jsonbin.io</a></p>
        </div>
    </div>

    <div id="app-container" style="display:none;">
        <header class="header">
            <div class="logo"><div class="logo-icon">ğŸš—</div><div class="logo-text">Fleet<span>Reserve</span></div></div>
            <div class="header-actions">
                <button class="sync-btn" id="sync-btn" onclick="loadData()"><span class="sync-icon">ğŸ”„</span><span>Sync</span></button>
                <div class="admin-toggle" id="admin-toggle" onclick="handleAdminToggle()"><span id="admin-icon">ğŸ”’</span><span>Admin</span><div class="toggle-switch"></div></div>
            </div>
        </header>
        <div class="main-container">
            <aside class="sidebar">
                <div class="sidebar-title"><span>ğŸš—</span><span>Fleet Vehicles</span></div>
                <div class="car-list" id="car-list"></div>
                <div class="add-car-form" id="add-car-form" style="display:none;">
                    <div class="form-group"><label>Car Name</label><input type="text" id="new-car-name" placeholder="e.g., Toyota Corolla"></div>
                    <div class="form-group"><label>License Plate</label><input type="text" id="new-car-plate" placeholder="e.g., ABC-1234"></div>
                    <button class="btn btn-primary btn-sm" onclick="addCar()"><span>+</span><span>Add Vehicle</span></button>
                </div>
            </aside>
            <main class="calendar-container">
                <div class="no-car-selected" id="no-car-message"><div class="icon">ğŸš—</div><h2>Select a Vehicle</h2><p>Choose a car from the sidebar to view and manage bookings</p></div>
                <div id="calendar-view" style="display:none;">
                    <div class="calendar-header">
                        <div class="calendar-nav"><button class="nav-btn" onclick="prevMonth()">â—€</button><h2 class="current-month" id="current-month"></h2><button class="nav-btn" onclick="nextMonth()">â–¶</button></div>
                        <button class="today-btn" onclick="goToToday()">Today</button>
                    </div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-dot morning"></div><span>Morning (6AM-12PM)</span></div>
                        <div class="legend-item"><div class="legend-dot evening"></div><span>Evening (12PM-10PM)</span></div>
                        <div class="legend-item"><div class="legend-dot booked"></div><span>Booked</span></div>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-weekdays"><div class="weekday">Sun</div><div class="weekday">Mon</div><div class="weekday">Tue</div><div class="weekday">Wed</div><div class="weekday">Thu</div><div class="weekday">Fri</div><div class="weekday">Sat</div></div>
                        <div class="calendar-days" id="calendar-days"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="modal-overlay" id="admin-modal"><div class="modal"><h3 class="modal-title">ğŸ”’ Admin Authentication</h3><div class="form-group"><label>Enter Admin Code</label><input type="password" id="admin-code" placeholder="Enter code..."></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeAdminModal()">Cancel</button><button class="btn btn-primary" onclick="verifyAdminCode()">Verify</button></div></div></div>
    <div class="modal-overlay" id="booking-modal"><div class="modal"><h3 class="modal-title">ğŸ“… Book Vehicle</h3><p id="booking-info" style="color:var(--text-secondary);margin-bottom:1rem;"></p><div class="form-group"><label>Your Name</label><input type="text" id="booker-name" placeholder="Enter your name..."></div><div class="modal-actions"><button class="btn btn-secondary" onclick="closeBookingModal()">Cancel</button><button class="btn btn-primary" onclick="confirmBooking()">Confirm Booking</button></div></div></div>
    <div class="toast" id="toast"><span id="toast-icon">âœ“</span><span id="toast-message"></span></div>
    <div class="loading-overlay" id="loading"><div class="spinner">ğŸš—</div><p>Loading Fleet Reserve...</p></div>

    <script>
        const JSONBIN_API = 'https://api.jsonbin.io/v3';
        const CAR_ICONS = ['ğŸš—','ğŸš™','ğŸš','ğŸš•','ğŸš˜','ğŸï¸'];
        const MONTH_NAMES = ['January','February','March','April','May','June','July','August','September','October','November','December'];
        const DEFAULT_DATA = { cars: [{id:'1',name:'Toyota Camry',plate:'ABC-1234',icon:'ğŸš—'},{id:'2',name:'Honda CR-V',plate:'XYZ-5678',icon:'ğŸš™'},{id:'3',name:'Ford Transit',plate:'DEF-9012',icon:'ğŸš'}], bookings: {} };

        let state = { binId: CONFIG.BIN_ID, cars: [], bookings: {}, selectedCar: null, currentDate: new Date(), isAdmin: false, pendingBooking: null };

        async function init() {
            if (!CONFIG.API_KEY || CONFIG.API_KEY === 'YOUR_API_KEY_HERE') {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('config-notice').style.display = 'flex';
                return;
            }
            try {
                if (CONFIG.BIN_ID) { await loadDataFromBin(); } else { await createNewBin(); }
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app-container').style.display = 'block';
                renderCarList(); renderCalendar();
                setInterval(loadData, 30000);
            } catch (error) {
                document.getElementById('loading').innerHTML = '<div style="text-align:center;color:var(--accent-red);"><h2>âš ï¸ Connection Error</h2><p>'+error.message+'</p></div>';
            }
        }

        async function createNewBin() {
            const response = await fetch(JSONBIN_API+'/b', { method:'POST', headers:{'Content-Type':'application/json','X-Master-Key':CONFIG.API_KEY,'X-Bin-Name':'fleet-reserve','X-Bin-Private':'false'}, body:JSON.stringify(DEFAULT_DATA) });
            if (!response.ok) throw new Error('Failed to create database');
            const data = await response.json();
            state.binId = data.metadata.id;
            state.cars = DEFAULT_DATA.cars;
            state.bookings = DEFAULT_DATA.bookings;
            alert('âœ… Database created!\n\nğŸ“‹ Copy this BIN_ID to your index.html:\n\n'+state.binId+'\n\nThen re-upload to GitHub.');
        }

        async function loadDataFromBin() {
            const response = await fetch(JSONBIN_API+'/b/'+state.binId+'/latest', { headers:{'X-Master-Key':CONFIG.API_KEY} });
            if (!response.ok) throw new Error('Failed to load data');
            const data = await response.json();
            state.cars = data.record.cars || [];
            state.bookings = data.record.bookings || {};
        }

        async function saveData() {
            if (!state.binId) return;
            try {
                await fetch(JSONBIN_API+'/b/'+state.binId, { method:'PUT', headers:{'Content-Type':'application/json','X-Master-Key':CONFIG.API_KEY}, body:JSON.stringify({cars:state.cars,bookings:state.bookings}) });
            } catch (e) { showToast('Failed to save','error'); }
        }

        async function loadData() {
            if (!state.binId) return;
            document.getElementById('sync-btn').classList.add('syncing');
            try { await loadDataFromBin(); renderCarList(); renderCalendar(); showToast('Data synced!','success'); }
            catch (e) { showToast('Failed to sync','error'); }
            finally { document.getElementById('sync-btn').classList.remove('syncing'); }
        }

        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            document.getElementById('toast-icon').textContent = type==='success'?'âœ“':'!';
            document.getElementById('toast-message').textContent = msg;
            t.className = 'toast active '+type;
            setTimeout(()=>t.classList.remove('active'), 3000);
        }

        function renderCarList() {
            document.getElementById('car-list').innerHTML = state.cars.map(c=>'<div class="car-item '+(state.selectedCar===c.id?'selected':'')+'" onclick="selectCar(\''+c.id+'\')"><div class="car-info"><span class="car-icon">'+c.icon+'</span><div><div class="car-name">'+c.name+'</div><div class="car-plate">'+c.plate+'</div></div></div>'+(state.isAdmin?'<button class="delete-car" onclick="event.stopPropagation();deleteCar(\''+c.id+'\')">âœ•</button>':'')+'</div>').join('');
            document.getElementById('add-car-form').style.display = state.isAdmin?'block':'none';
        }

        function selectCar(id) { state.selectedCar=id; renderCarList(); document.getElementById('no-car-message').style.display='none'; document.getElementById('calendar-view').style.display='block'; renderCalendar(); }

        async function addCar() {
            const name=document.getElementById('new-car-name').value.trim(), plate=document.getElementById('new-car-plate').value.trim().toUpperCase();
            if(!name||!plate){showToast('Please fill all fields','error');return;}
            state.cars.push({id:Date.now().toString(),name,plate,icon:CAR_ICONS[Math.floor(Math.random()*CAR_ICONS.length)]});
            await saveData();
            document.getElementById('new-car-name').value='';document.getElementById('new-car-plate').value='';
            renderCarList(); showToast('Car added!','success');
        }

        async function deleteCar(id) {
            state.cars=state.cars.filter(c=>c.id!==id);
            const nb={};Object.keys(state.bookings).forEach(k=>{if(!k.startsWith(id+'_'))nb[k]=state.bookings[k];});state.bookings=nb;
            if(state.selectedCar===id){state.selectedCar=null;document.getElementById('no-car-message').style.display='flex';document.getElementById('calendar-view').style.display='none';}
            await saveData(); renderCarList(); showToast('Car removed','success');
        }

        function prevMonth(){state.currentDate=new Date(state.currentDate.getFullYear(),state.currentDate.getMonth()-1,1);renderCalendar();}
        function nextMonth(){state.currentDate=new Date(state.currentDate.getFullYear(),state.currentDate.getMonth()+1,1);renderCalendar();}
        function goToToday(){state.currentDate=new Date();renderCalendar();}

        function renderCalendar() {
            if(!state.selectedCar)return;
            const y=state.currentDate.getFullYear(),m=state.currentDate.getMonth();
            document.getElementById('current-month').textContent=MONTH_NAMES[m]+' '+y;
            const fd=new Date(y,m,1),sd=new Date(fd);sd.setDate(sd.getDate()-fd.getDay());
            const today=new Date();let html='';
            for(let i=0;i<42;i++){
                const d=new Date(sd);d.setDate(sd.getDate()+i);
                const cm=d.getMonth()===m,it=d.toDateString()===today.toDateString(),dk=d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');
                const mb=state.bookings[state.selectedCar+'_'+dk+'_morning'],eb=state.bookings[state.selectedCar+'_'+dk+'_evening'];
                html+='<div class="calendar-day '+(cm?'':'other-month ')+( it?'today':'')+'"><div class="day-number"><span>'+d.getDate()+'</span></div><div class="booking-slots">';
                html+='<div class="booking-slot morning '+(mb?'booked':'available')+' '+(mb&&state.isAdmin?'admin-view':'')+'" onclick="handleSlot(\''+dk+'\',\'morning\')" title="'+(mb?'Booked by '+mb.name:'Click to book')+'"><span class="slot-label"><span>â˜€ï¸</span><span>AM</span></span>'+(mb?'<span class="booked-by">'+mb.name+'</span>'+(state.isAdmin?'<span class="remove-booking">âœ•</span>':''):'')+'</div>';
                html+='<div class="booking-slot evening '+(eb?'booked':'available')+' '+(eb&&state.isAdmin?'admin-view':'')+'" onclick="handleSlot(\''+dk+'\',\'evening\')" title="'+(eb?'Booked by '+eb.name:'Click to book')+'"><span class="slot-label"><span>ğŸŒ™</span><span>PM</span></span>'+(eb?'<span class="booked-by">'+eb.name+'</span>'+(state.isAdmin?'<span class="remove-booking">âœ•</span>':''):'')+'</div>';
                html+='</div></div>';
            }
            document.getElementById('calendar-days').innerHTML=html;
        }

        async function handleSlot(dk,slot) {
            if(!state.selectedCar)return;
            const key=state.selectedCar+'_'+dk+'_'+slot,b=state.bookings[key];
            if(b){if(state.isAdmin){delete state.bookings[key];await saveData();renderCalendar();showToast('Booking removed','success');}}
            else{const[y,m,d]=dk.split('-');document.getElementById('booking-info').innerHTML='Booking for <strong>'+new Date(y,m-1,d).toDateString()+'</strong> - '+(slot==='morning'?'Morning (6AM-12PM)':'Evening (12PM-10PM)');state.pendingBooking={dk,slot};document.getElementById('booking-modal').classList.add('active');document.getElementById('booker-name').focus();}
        }

        async function confirmBooking() {
            const name=document.getElementById('booker-name').value.trim();
            if(!name){showToast('Please enter your name','error');return;}
            try{await loadDataFromBin();}catch(e){}
            const key=state.selectedCar+'_'+state.pendingBooking.dk+'_'+state.pendingBooking.slot;
            if(state.bookings[key]){showToast('Slot just booked by someone else!','error');closeBookingModal();renderCalendar();return;}
            state.bookings[key]={name,bookedAt:new Date().toISOString()};
            await saveData();document.getElementById('booker-name').value='';closeBookingModal();renderCalendar();showToast('Booking confirmed!','success');
        }

        function closeBookingModal(){document.getElementById('booking-modal').classList.remove('active');document.getElementById('booker-name').value='';state.pendingBooking=null;}
        function handleAdminToggle(){if(state.isAdmin){state.isAdmin=false;updateAdminUI();showToast('Admin mode disabled','success');}else{document.getElementById('admin-modal').classList.add('active');document.getElementById('admin-code').focus();}}
        function verifyAdminCode(){if(document.getElementById('admin-code').value===ADMIN_CODE){state.isAdmin=true;closeAdminModal();updateAdminUI();showToast('Admin mode enabled','success');}else{showToast('Invalid code','error');}}
        function closeAdminModal(){document.getElementById('admin-modal').classList.remove('active');document.getElementById('admin-code').value='';}
        function updateAdminUI(){const t=document.getElementById('admin-toggle'),i=document.getElementById('admin-icon');if(state.isAdmin){t.classList.add('active');i.textContent='ğŸ”“';}else{t.classList.remove('active');i.textContent='ğŸ”’';}renderCarList();renderCalendar();}

        document.addEventListener('keydown',e=>{if(e.key==='Enter'){if(document.getElementById('admin-modal').classList.contains('active'))verifyAdminCode();else if(document.getElementById('booking-modal').classList.contains('active'))confirmBooking();}if(e.key==='Escape'){closeAdminModal();closeBookingModal();}});
        window.onload=init;
    </script>
</body>
</html>
